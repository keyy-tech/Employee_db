<!-- filepath: c:\Users\emman\OneDrive\Desktop\Employee_db\templates\dashboard\leave_list.html -->
{% extends "base_generic.html" %}

{% block content %}
    <div class="container mt-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between mb-3">
                    <div>
                        <label for="entriesSelect">Show</label>
                        <select id="entriesSelect" class="form-select form-select-sm d-inline-block w-auto">
                            <option value="10">10</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        <label for="entriesSelect">entries</label>
                    </div>
                    <div>
                        <input type="text" id="searchInput" class="form-control form-control-sm"
                               placeholder="Search...">
                    </div>
                </div>
                <table class="table table-striped table-hover table-bordered shadow-sm">
                    <thead class="table-dark">
                    <tr>
                        <th>Employee Name</th>
                        <th>Job Position</th>
                        <th>Department</th>
                        <th>Payroll Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                    {% for employee in employees %}
                        <tr>
                            <td>{{ employee.user.first_name }} {{ employee.user.last_name }}</td>
                            <td>{{ employee.job_position }}</td>
                            <td>{{ employee.department.name }}</td>
                            <td>
                                {% if employee.payroll_set.exists %}
                                    <span class="badge badge-success"
                                          style="background-color:#28a745; padding: 10px; font-size: 15px; font-weight: normal">Completed</span>
                                {% else %}
                                    <span class="badge badge-danger"
                                          style="background-color:#dc3545; padding: 10px; font-size: 15px; font-weight: normal">Not Completed</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if not employee.payroll_set.exists %}
                                    <a href="{% url 'payroll_create' id=employee.id %}" class="btn btn-primary btn-sm">Add
                                        Payroll</a>
                                {% else %}
                                    {% for payroll in employee.payroll_set.all %}
                                        <a href="{% url 'payroll_update' id=payroll.id %}"
                                           class="btn btn-primary btn-sm">Update</a>
                                        <button class="btn btn-danger btn-sm" data-bs-toggle="modal"
                                                data-bs-target="#deleteModal" data-id="{{ payroll.id }}">Delete
                                        </button>
                                    {% endfor %}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Delete Payroll</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this payroll?
                </div>
                <div class="modal-footer">
                    <form id="deleteForm" method="post" action="">
                        {% csrf_token %}
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const entriesSelect = document.getElementById("entriesSelect");
            const searchInput = document.getElementById("searchInput");
            const employeeTableBody = document.getElementById("employeeTableBody");
            const rows = Array.from(employeeTableBody.getElementsByTagName("tr"));

            entriesSelect.addEventListener("change", function () {
                const value = parseInt(entriesSelect.value, 10);
                rows.forEach((row, index) => {
                    row.style.display = index < value ? "" : "none";
                });
            });

            searchInput.addEventListener("input", function () {
                const searchTerm = searchInput.value.toLowerCase();
                rows.forEach((row) => {
                    const cells = Array.from(row.getElementsByTagName("td"));
                    const matches = cells.some((cell) =>
                        cell.textContent.toLowerCase().includes(searchTerm)
                    );
                    row.style.display = matches ? "" : "none";
                });
            });

            // Initialize the table to show the first 10 entries
            entriesSelect.value = "10";
            entriesSelect.dispatchEvent(new Event("change"));

            // Handle delete modal
            const deleteModal = document.getElementById('deleteModal');
            deleteModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const payrollId = button.getAttribute('data-id');
                const form = document.getElementById('deleteForm');
                form.action = '{% url "payroll_delete" 0 %}'.replace('0', payrollId);
            });
        });
    </script>
{% endblock %}

<style>
    .table {
        border-radius: 10px; /* Add border radius to the table */
        overflow: hidden; /* Ensure rounded corners are visible */
    }

    .table thead {
        background-color: #343a40; /* Dark background for the table header */
        color: white; /* White text for the table header */
    }

    .table-hover tbody tr:hover {
        background-color: #f1f1f1; /* Light grey background on hover */
    }

    .badge-success {
        color: #28a745; /* Set the background color for the completed badge */
    }

    .badge-danger {
        color: #dc3545; /* Set the background color for the not completed badge */
    }

    .btn-primary {
        background-color: #007bff; /* Set the background color for the add payroll button */
        border-color: #007bff; /* Set the border color for the add payroll button */
    }
</style>