{% extends "base_generic.html" %} {% block content %}
<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between mb-3">
        <div>
          <label for="entriesSelect">Show</label>
          <select
            id="entriesSelect"
            class="form-select form-select-sm d-inline-block w-auto"
          >
            <option value="10">10</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
          <label for="entriesSelect">entries</label>
        </div>
        <div>
          <input
            type="text"
            id="searchInput"
            class="form-control form-control-sm"
            placeholder="Search..."
          />
        </div>
      </div>
      <table class="table table-striped table-hover table-bordered">
        <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>HOD</th>
            <th>Number of Employees</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="departmentTableBody">
          {% for department in departments %}
          <tr>
            <td>{{ department.name }}</td>
            <td>{{ department.hod }}</td>
            <td>{{ department.num_employees }}</td>
            <td>
              <a
                href="{% url 'update_department' department.id %}"
                class="btn btn-warning btn-sm"
                >Edit</a
              >
              <button
                type="button"
                class="btn btn-danger btn-sm"
                data-bs-toggle="modal"
                data-bs-target="#deleteModal{{ department.id }}"
              >
                Delete
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% for department in departments %}
  <!-- Delete Modal -->
  <div
    class="modal fade"
    id="deleteModal{{ department.id }}"
    tabindex="-1"
    aria-labelledby="deleteModalLabel{{ department.id }}"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel{{ department.id }}">
            Delete Department
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete the department "{{ department.name
          }}"?
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <form
            method="post"
            action="{% url 'delete_department' department.id %}"
          >
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Delete</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}

<style>
  .table {
    border-radius: 10px; /* Add border radius to the table */
    overflow: hidden; /* Ensure rounded corners are visible */
  }
  .table thead {
    background-color: #343a40; /* Dark background for the table header */
    color: white; /* White text for the table header */
  }
  .table-hover tbody tr:hover {
    background-color: #f1f1f1; /* Light grey background on hover */
  }
  .btn-warning {
    background-color: #ffc107; /* Set the background color for the edit button */
    border-color: #ffc107; /* Set the border color for the edit button */
  }
  .btn-danger {
    background-color: #dc3545; /* Set the background color for the delete button */
    border-color: #dc3545; /* Set the border color for the delete button */
  }
  .modal-content {
    border-radius: 10px; /* Add border radius to the modal */
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const entriesSelect = document.getElementById("entriesSelect");
    const searchInput = document.getElementById("searchInput");
    const departmentTableBody = document.getElementById("departmentTableBody");
    const rows = Array.from(departmentTableBody.getElementsByTagName("tr"));

    entriesSelect.addEventListener("change", function () {
      const value = parseInt(entriesSelect.value, 10);
      rows.forEach((row, index) => {
        row.style.display = index < value ? "" : "none";
      });
    });

    searchInput.addEventListener("input", function () {
      const searchTerm = searchInput.value.toLowerCase();
      rows.forEach((row) => {
        const cells = Array.from(row.getElementsByTagName("td"));
        const matches = cells.some((cell) =>
          cell.textContent.toLowerCase().includes(searchTerm)
        );
        row.style.display = matches ? "" : "none";
      });
    });

    // Initialize the table to show the first 10 entries
    entriesSelect.value = "10";
    entriesSelect.dispatchEvent(new Event("change"));
  });
</script>
